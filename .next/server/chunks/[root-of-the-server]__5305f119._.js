module.exports=[406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},8523,e=>{"use strict";var t=e.i(6747),r=e.i(9245),o=e.i(4898),s=e.i(2950);async function n(t,r){if("POST"!==t.method)return r.status(405).json({error:"Use POST"});console.log("DBG: GOOGLE_CLIENT_EMAIL defined:",!!process.env.GOOGLE_CLIENT_EMAIL),console.log("DBG: GOOGLE_PRIVATE_KEY defined:",!!process.env.GOOGLE_PRIVATE_KEY),console.log("DBG: GOOGLE_PRIVATE_KEY length:",process.env.GOOGLE_PRIVATE_KEY?process.env.GOOGLE_PRIVATE_KEY.length:"undefined"),console.log("DBG: GOOGLE_APPLICATION_CREDENTIALS:",process.env.GOOGLE_APPLICATION_CREDENTIALS||"undefined"),console.log("DBG: DRIVE_FILE_ID defined:",!!process.env.DRIVE_FILE_ID);try{let o,{google:s}=await e.A(8006),{JWT:n}=await e.A(1512),a=await e.A(1193),i=a.default??a;try{"function"==typeof i.configure?i.configure({access_token:process.env.MP_ACCESS_TOKEN}):i?.configurations?.setAccessToken?i.configurations.setAccessToken(process.env.MP_ACCESS_TOKEN):"function"==typeof i.setAccessToken?i.setAccessToken(process.env.MP_ACCESS_TOKEN):console.warn("SDK do Mercado Pago: método de configuração não encontrado. Continuando sem configurar via SDK.")}catch(e){console.warn("Falha ao configurar MercadoPago (não crítico):",e?.message||e)}let l=await e.A(3970);try{let e=process.env.GOOGLE_PRIVATE_KEY,t=process.env.GOOGLE_APPLICATION_CREDENTIALS&&l.existsSync(process.env.GOOGLE_APPLICATION_CREDENTIALS)?(()=>{let e=Error("Cannot find module as expression is too dynamic");throw e.code="MODULE_NOT_FOUND",e})().private_key:void 0,r=e||t||void 0;if(r){let e=r.slice(0,160).replace(/\n/g,"\\n");console.log("DBG: private_key preview:",e),console.log("DBG: private_key contains ENCRYPTED:",e.includes("ENCRYPTED")),console.log("DBG: private_key contains BEGIN RSA PRIVATE KEY:",e.includes("BEGIN RSA PRIVATE KEY")),console.log("DBG: private_key contains BEGIN PRIVATE KEY:",e.includes("BEGIN PRIVATE KEY")),console.log("DBG: private_key contains literal backslash-n sequences:",/\\n/.test(r))}else console.log("DBG: private_key not found in env or file")}catch(e){console.warn("DBG: falha ao gerar preview da private_key:",e?.message||e)}try{o=function(){if(process.env.GOOGLE_PRIVATE_KEY&&process.env.GOOGLE_CLIENT_EMAIL){let e=process.env.GOOGLE_PRIVATE_KEY.replace(/\\n/g,"\n");return new n({email:process.env.GOOGLE_CLIENT_EMAIL,key:e,scopes:["https://www.googleapis.com/auth/drive"]})}if(process.env.GOOGLE_APPLICATION_CREDENTIALS&&l.existsSync(process.env.GOOGLE_APPLICATION_CREDENTIALS)){let e=(()=>{let e=Error("Cannot find module as expression is too dynamic");throw e.code="MODULE_NOT_FOUND",e})(),t=(e.private_key||"").replace(/\\n/g,"\n");return new n({email:e.client_email,key:t,scopes:["https://www.googleapis.com/auth/drive"]})}throw Error("Nenhuma credencial encontrada: defina GOOGLE_PRIVATE_KEY/GOOGLE_CLIENT_EMAIL ou GOOGLE_APPLICATION_CREDENTIALS")}()}catch(e){return console.error("Auth create client failed:",e.message||e),r.status(500).json({error:"Auth create client failed",details:e.message||String(e)})}try{let e=await o.authorize();console.log("DBG: Google auth OK, token keys:",Object.keys(e||{}))}catch(e){return console.error("Auth authorize failed:",e.response?.data||e.message||e),r.status(500).json({error:"Auth authorize failed",details:e.response?.data||e.message||String(e)})}let c=s.drive({version:"v3",auth:o}),{status:d,payer:p}=t.body||{};if("approved"!==d)return r.status(200).json({message:"Pagamento não aprovado"});let E=p?.email;if(!E)return r.status(400).json({error:"Email do comprador não encontrado"});try{await c.permissions.create({fileId:process.env.DRIVE_FILE_ID,requestBody:{type:"user",role:"reader",emailAddress:E},sendNotificationEmail:!0})}catch(e){return console.error("Drive permissions.create failed:",e.response?.data||e.message||e),r.status(500).json({error:"Drive permissions failed",details:e.response?.data||e.message||String(e)})}return r.status(200).json({ok:!0,message:"Acesso liberado ao PDF"})}catch(e){return console.error("Erro no webhook:",e),r.status(500).json({error:"Erro interno",details:e?.message||String(e)})}}e.s(["default",()=>n],7257);var a=e.i(7257),i=e.i(7031),l=e.i(1927),c=e.i(6432);let d=(0,s.hoist)(a,"default"),p=(0,s.hoist)(a,"config"),E=new o.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/payment-webhook",pathname:"/api/payment-webhook",bundlePath:"",filename:""},userland:a,distDir:".next",relativeProjectDir:""});async function u(e,r,o){E.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/payment-webhook";s=s.replace(/\/index$/,"")||"/";let n=await E.prepare(e,r,{srcPage:s});if(!n){r.statusCode=400,r.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve());return}let{query:a,params:d,prerenderManifest:p,routerServerContext:u}=n;try{let t=e.method||"GET",o=(0,i.getTracer)(),n=o.getActiveScopeSpan(),c=E.instrumentationOnRequestError.bind(E),_=async n=>E.render(e,r,{query:{...a,...d},params:d,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:p.preview,propagateError:!1,dev:E.isDev,page:"/api/payment-webhook",internalRevalidate:null==u?void 0:u.revalidate,onError:(...t)=>c(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let e=o.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=e.get("next.route");if(a){let e=`${t} ${a}`;n.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),n.updateName(e)}else n.updateName(`${t} ${s}`)});n?await _(n):await o.withPropagatedContext(e.headers,()=>o.trace(l.BaseServerSpan.handleRequest,{spanName:`${t} ${s}`,kind:i.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},_))}catch(e){if(E.isDev)throw e;(0,t.sendError)(r,500,"Internal Server Error")}finally{null==o.waitUntil||o.waitUntil.call(o,Promise.resolve())}}e.s(["config",0,p,"default",0,d,"handler",()=>u],8523)},8006,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_googleapis_c62f7795._.js"].map(t=>e.l(t))).then(()=>t(182)))},1512,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_google-auth-library_ce15d130._.js"].map(t=>e.l(t))).then(()=>t(3965)))},1193,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_mercadopago_80784e56._.js"].map(t=>e.l(t))).then(()=>t(1647)))},3970,e=>{e.v(t=>Promise.all(["server/chunks/[externals]_fs_54ffce70._.js"].map(t=>e.l(t))).then(()=>t(2734)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5305f119._.js.map